---
title: "Main"
author: "Tan Hao Qin"
date: "2 August 2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('mlogit')
```

## R Markdown


```{r cars}
train <- read.csv('train.csv')
test <- read.csv('test.csv')
submission <- read.csv('samplesubmission.csv')
str(train)
str(test)
summary(train)
summary(test)
```

```{r train}
D <- mlogit.data(subset(train, Task <= 12), shape = 'wide', choice = "Choice", varying = c(4:83), sep = '', alt.levels = c("Ch1", "Ch2", "Ch3", "Ch4"), id.var = "Case")
model1 <- mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = D)
summary(model1)
```

```{r validate}
V <- mlogit.data(subset(train, Task > 12), shape = 'wide', choice = "Choice", varying = c(4:83), sep = '', alt.levels = c("Ch1", "Ch2", "Ch3", "Ch4"), id.var = "Case")
predict(model1, newdata = V)
```

```{r test}
test$income <- lapply(test$income, as.character)
test$income <- factor(test$income, levels=levels(train$income))


Test <- mlogit.data(test, shape = 'wide', choice = "Choice", varying = c(4:83), sep = '', alt.levels = c("Ch1", "Ch2", "Ch3", "Ch4"), id.var = "Case")
Test$Ch1 = 0
Test$Ch2 = 0
Test$Ch3 = 0
Test$Ch4 = 0
Test$Choice = FALSE
```

```{r}
TestPredict <- predict(model1, newdata = Test)
Submission1 <- submission
for (i in 1:length(TestPredict)){
  for (j in colnames(TestPredict)){
    Submission1[i,j] = TestPredict[i,j]
  }
}
write.csv(Submission1, file = 'Submission1.csv')
```

```{r model2}
model2 <- mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = D, rpar = c(CC = 'n',  GN = 'n',  NS = 'n',  BU = 'n',  FA = 'n',  LD = 'n',  BZ = 'n',  FC = 'n',  FP = 'n',  RP = 'n',  PP = 'n',  KA = 'n',  SC = 'n',  TS = 'n',  NV = 'n',  MA = 'n',  LB = 'n',  AF = 'n',  HU = 'n', Price = 'n'), panel = TRUE, print.level = TRUE)
summary(model2)
```

```{r pred2}
Pred2 <- predict(model2, newdata = Test)
Submission2 <- submission
for (i in 1:length(Pred2)){
  for (j in colnames(Pred2)){
    Submission2[i,j] = Pred2[i,j]
  }
}
write.csv(Submission2, file = 'Submission2.csv')
```



```{r}
#TODO: Convert from factors to numerical values

#miles

```


```{r}
train <- read.csv('train.csv')
summary(train)
str(train)

#change gender, male = 1, female = 0
train$gender <- ifelse(train$gender == 'Male', 1, 0)

#change miles to avg of range, except over 400 which becomes 500
train$miles <- factor(train$miles, levels = c("Under 50 Miles","51 To 100 Miles","101 To 150 Miles","151 To 200 Miles","201 To 250 Miles","251 To 300 Miles","301 To 350 Miles","351 To 400 Miles","Over 400 Miles"))
table(train$miles)
train$miles <- (as.numeric(train$miles)-1)*50 + 25
table(train$miles)
train$miles <- ifelse(train$miles == 425, 500, train$miles)
table(train$miles)

#change night percentage to average of range
train$night<- factor(train$night, levels = c("Under 10%","10% To 20%","21% To 30%", "31% To 40%", "41% To 50%","51% To 60%","61% To 70%", "71% To 80%","81% To 90%","91% To 100%" ))
table(train$night)
train$night <- (as.numeric(train$night)-1)*10+5
table(train$night)

#change age to average of age, except over 60 changed to 70
train$age <- factor(train$age, levels = c("Under 30", "30 To 39", "40 To 49", "50 To 59", "60 & Over"))
table(train$age)
train$age <- (as.numeric(train$age)-1)*10+25
train$age <- ifelse(train$age==65, 70, train$age)

str(train)


#change urbanisation, with Rural/Country = 0, Suburban = 1, Urban/City = 2
train$Urb <- ifelse(train$Urb=="Rural/Country", 0, ifelse(train$Urb=="Suburban", 1, ifelse(train$Urb=="Urban/City", 2, train$Urb)))
str(train$Urb)
str(train)

#change education, Grade School = 0, High School = 1, Trade/Vocational School = 2, Some College (1-3 Years) = 3, College Graduate (4 Years) = 4, Postgraduate College = 5
#str(train$educ)
#summary(train$educ)
#head(train$educ)
#train$educ <- as.character(train$educ)
#ifelse(train$educ=="Grade School", 0, train$educ)
#ifelse(train$educ=="High School", 1, train$educ)
#ifelse(train$educ=="Trade/Vocational School", 2, train$educ)
#ifelse(train$educ=="Some College (1-3 Years)", 3, train$educ)
#ifelse(train$educ=="College Graduate (4 Years)", 4, train$educ)
#ifelse(train$educ=="Postgraduate College", 5, train$educ)

#ifelse(train$educ=="Grade School", 0, ifelse(train$educ=="High School", 1, ifelse(train$educ=="Trade/Vocational School", 2, ifelse(train$educ=="Some College (1-3 Years)", 3, ifelse(train$educ=="College Graduate (4 Years)", 4, ifelse(train$educ=="Postgraduate College", 5, "Other"))))))



#str(train$educ)
#summary(train$educ)
#head(train$educ)
```
