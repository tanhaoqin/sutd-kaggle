---
title: "Main"
author: "Tan Hao Qin"
date: "2 August 2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('mlogit')
```

## R Markdown


```{r cars}
train <- read.csv('train.csv')
test <- read.csv('test.csv')
submission <- read.csv('samplesubmission.csv')
str(train)
str(test)
summary(train)
summary(test)
```

```{r train}
D <- mlogit.data(subset(train, Task <= 12), shape = 'wide', choice = "Choice", varying = c(4:83), sep = '', alt.levels = c("Ch1", "Ch2", "Ch3", "Ch4"), id.var = "Case")

V <- mlogit.data(subset(train, Task > 12), shape = 'wide', choice = "Choice", varying = c(4:83), sep = '', alt.levels = c("Ch1", "Ch2", "Ch3", "Ch4"), id.var = "Case")
ActualChoice <- subset(train, Task > 12)[,"Choice"]
```

Simple models
```{r}
model1 <- mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = D)
summary(model1)

model3star <- mlogit(Choice~CC+BU+KA+SC+TS+MA+Price-1, data = D)
summary(model3star)

model2star <- mlogit(Choice~CC+BU+KA+SC+TS+MA+GN+LD+Price-1, data = D)
summary(model2star)

model1star <- mlogit(Choice~CC+BU+KA+SC+TS+MA+GN+LD+NS+BZ+RP+LB+HU+Price-1, data = D)
summary(model1star)
```

```{r validate}
predict1 <- predict(model1, newdata = V)
predict3star <- predict(model3star, newdata = V)
predict2star <- predict(model2star, newdata = V)
predict1star <- predict(model1star, newdata = V)

PredictChoice1 <- apply(predict1, 1, which.max)
PredictChoice3star <- apply(predict3star, 1, which.max)
PredictChoice2star <- apply(predict2star, 1, which.max)
PredictChoice1star <- apply(predict1star, 1, which.max)

t1 <- table(ActualChoice, PredictChoice1)
t3s <- table(ActualChoice, PredictChoice3star)
t2s <- table(ActualChoice, PredictChoice2star)
t1s <- table(ActualChoice, PredictChoice1star)

choiceVector <- vector(mode = "list", length = 4)
choiceVector[[1]] <- t1
choiceVector[[2]] <- t3s
choiceVector[[3]] <- t2s
choiceVector[[4]] <- t1s
```

```{r}
accurate_cnt <- c()
for(i in 1:4){
  accurate_cnt <- c(accurate_cnt, 0)
  for(j in 1:4){
    accurate_cnt[i] <- accurate_cnt[i] + choiceVector[[i]][j,j]
  }
}
accurate_cnt
```

```{r test}
test$income <- lapply(test$income, as.character)
test$income <- factor(test$income, levels=levels(train$income))


Test <- mlogit.data(test, shape = 'wide', choice = "Choice", varying = c(4:83), sep = '', alt.levels = c("Ch1", "Ch2", "Ch3", "Ch4"), id.var = "Case")
Test$Ch1 = 0
Test$Ch2 = 0
Test$Ch3 = 0
Test$Ch4 = 0
Test$Choice = FALSE
```

```{r}
TestPredict <- predict(model1, newdata = Test)
Submission1 <- submission
for (i in 1:length(TestPredict)){
  for (j in colnames(TestPredict)){
    Submission1[i,j] = TestPredict[i,j]
  }
}
write.csv(Submission1, file = 'Submission1.csv')
```

```{r}
TestPredict <- predict(model1star, newdata = Test)
Submission3 <- submission
for (i in 1:length(TestPredict)){
  for (j in colnames(TestPredict)){
    Submission3[i,j] = TestPredict[i,j]
  }
}
write.csv(Submission3, file = 'Submission3.csv')
```

```{r model2}
model2 <- mlogit(Choice~CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = D, rpar = c(CC = 'n',  GN = 'n',  NS = 'n',  BU = 'n',  FA = 'n',  LD = 'n',  BZ = 'n',  FC = 'n',  FP = 'n',  RP = 'n',  PP = 'n',  KA = 'n',  SC = 'n',  TS = 'n',  NV = 'n',  MA = 'n',  LB = 'n',  AF = 'n',  HU = 'n', Price = 'n'), panel = TRUE, print.level = TRUE)
summary(model2)
```

```{r pred2}
Pred2 <- predict(model2, newdata = Test)
Submission2 <- submission
for (i in 1:length(Pred2)){
  for (j in colnames(Pred2)){
    Submission2[i,j] = Pred2[i,j]
  }
}
write.csv(Submission2, file = 'Submission2.csv')
```



```{r}
#TODO: Convert from factors to numerical values

#miles

```


```{r}
train <- read.csv('train.csv')
#train$gender <- as.character(train$gender)
#summary(train)

train$gender <- ifelse(train$gender == 'Male', 1, 0)

train$miles <- factor(train$miles, levels = c("Under 50 Miles","51 To 100 Miles","101 To 150 Miles","151 To 200 Miles","201 To 250 Miles","251 To 300 Miles","301 To 350 Miles","351 To 400 Miles","Over 400 Miles"))
table(train$miles)
train$miles <- (as.numeric(train$miles)-1)*50 + 25
table(train$miles)
train$miles <- ifelse(train$miles == 425, 500, train$miles)
table(train$miles)
```

```{r}

```